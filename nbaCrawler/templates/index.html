{% extends "base.html" %}
{% block title %}NBA Crawler{% endblock %}

{% block body %}
    <div class="alert alert-warning" role="alert" style="display: none">
        <a href="#" class="close" data-dismiss="alert">
            &times;
        </a>
        <strong>資料有更動，請重新整理</strong>
    </div>

    <div class="col-large align-items-center text-center">
        <h1> NBA CRAWLER </h1>
    </div>
    <div class="container" id="generatedTable">
        <div class="row" id="cloneDiv">
            <div class="col-sm text-center">
            </div>
            <div class="col-sm text-center">
            </div>
            <div class="col-sm text-center">
            </div>
        </div>
    </div>
    <script>
        var json_data;

        $.ajax({
            url: '/api/news/',
            dataType: 'json',
            type: 'GET',
            success: function (data) {
                json_data = data;
                var tr = $("#cloneDiv");
                $.each(data, function (index, item) {
                    var clonedTr = tr.clone();
                    clonedTr.children("div").each(function (inner_index) {
                        switch (inner_index) {
                            case(0):
                                $(this).html("<a href=\"" + item.id + "\">Detail</a>");
                                break;
                            case(1):
                                $(this).html(item.title);
                                break;
                            case(2):
                                $(this).html(item.time);
                                break;
                        }
                    });
                    clonedTr.insertAfter(tr);
                });
                tr.hide();
                $("#generatedTable").show();
            }
        });

        $(document).ready(function () {
            function count() {
                $.ajax({
                    url: '/api/news/',
                    dataType: 'json',
                    type: 'GET',
                    success: function (data) {
                        if (_.isEqual(data, json_data)) {
                        } else {
                            $(".alert").show();
                            json_data = data
                        }
                    }
                });
            }

            var auto_refresh = setInterval(function () {
                count()
            }, 3000);
            count();
        });
    </script>
{% endblock %}
