version: '2'
services:

    migration_and_run_worker:
      build: .
      command: bash -c "export C_FORCE_ROOT="true" && python manage.py celery worker --loglevel=info"
      volumes:
        - .:/nbaCrawler

    celery_beat:
      build: .
      command: bash -c "python manage.py celery beat"
      volumes:
        - .:/nbaCrawler

    app:
      build: .
      command: bash -c "python manage.py migrate &&
                        python manage.py runserver 0.0.0.0:8000"
      restart: always
      ports:
        - "8000:8000"
      volumes:
        - .:/nbaCrawler
      depends_on:
        - celery_beat
        - migration_and_run_worker